## 1. Требования к безопасности внешних интеграций

### 1.1. Шифрование и защита данных
- Все взаимодействия между мобильным приложением, внутренними системами PropDevelopment и сервисами партнёра осуществляются **только по защищённым каналам** (TLS 1.2 или выше, preference на TLS 1.3).
- **Передача биометрических данных (изображения лиц, шаблоны)** должна происходить в зашифрованном виде по надёжным каналам.
- **Логирование всех событий доступа** (запрос авторизации, открытие двери/шлагбаума, сбои) производится с минимальной детализацией для расследования инцидентов.
- **Данные о доступах и идентификаторах устройств** не должны храниться у партнёра без шифрования и должны быть доступны только строго необходимым сервисам.

### 1.2. Сегрегация данных и принцип наименьших привилегий
- **Внешняя платформа партнёра** не получает полных профилей собственников/жильцов — только те атрибуты, которые нужны для контроля доступа (hash, шаблон лица, идентификатор автомобиля и т.д.).
- Доступ к данным и функциям должен даваться только на основании явных прав — **чужие записи и события не должны быть видны другому партнёру или управляющей компании**.
- Все действия сервисов партнёра должны быть ограничены строго специфическими операциями (например, только "запрос на открытие двери" — без произвольного обращения к системе мобильного приложения).

### 1.3. Контроль соответствия законодательству РФ о ПДн
- Весь обмен, хранение и обработка биометрических и персональных данных соответствуют ФЗ-152, ФЗ-242 и локальным положениям о ПДн.
- Перед внедрением новый сервис проходит анализ ИБ и согласование с ответственным за ПДн.

### 1.4. Стандартизация и аудит интеграций
- На этапах подключения новых сервисов проводится предварительный аудит и согласование API-контрактов (белый список параметров, whitelisting, методы и их параметры).
- Требуется проведение pentest/белого тестирования интеграции до выхода в прод.
- Все изменения интеграционного API должны проходить согласование с ИБ и владельцем продукта со стороны PropDevelopment.

---

## 2. Протоколы аутентификации и авторизации

### 2.1. Аутентификация пользователей
- В мобильном приложении PropDevelopment пользователь проходит аутентификацию по текущей корпоративной схеме (например, по логину/паролю, MFA; оптимально — через OpenID Connect/OAuth2).
- Для сервисов «Умный дом» — авторизация каждой операции осуществляется только от лица аутентифицированного пользователя, идентификаторы (userID, deviceID, carID) предоставляются через токен.

### 2.2. Аутентификация сервис-сервис
- Для внешнего взаимодействия мобильного приложения и платформы партнёра использовать **OAuth2 Client Credentials Flow** или **JWT** (JSON Web Token) с подписанными ключами.
- Каждый экземпляр мобильного приложения, вызывающий управляющие функции (открытие двери, управление шлагбаумом), должен получать session access token с ограниченными правами и сроком жизни.
- Обязателен mutual-TLS (mTLS) между бэкендами, чтобы исключить подделку конечных точек.

### 2.3. Авторизация запросов
- Использовать **Scoping и Claim-based авторизацию**: при формировании токена указывать конкретный перечень разрешённых действий и объектов (например, только данный дом, только данный шлагбаум).
- Для всех критических команд — явно проверять наличие прав для пользователя (role/permission-based access), аудитировать и логировать каждое решение об авторизации.

---

## 3. Организация взаимодействия между системами

### 3.1. Потоки взаимодействия

1. **Пользователь авторизуется в мобильном приложении PropDevelopment.**
2. Приложение (через backend PropDevelopment) получает необходимые credentials для работы с сервисами партнёра (получает access token или session token).
3. При попытке открыть дверь или шлагбаум, приложение отправляет команду на backend PropDevelopment, который проверяет права и формирует безопасный запрос к API платформы партнёра.
4. **Обращение к сервису партнёра происходит только от имени зарегистрированного в системе пользователя**, с подписью/токеном и передачей ограниченного набора персональных атрибутов.
5. Платформа партнёра **авторизует запрос по access token**, выполняет действие (открытие, отказ и т.д.), регистрирует действие в логах и возвращает результат (Success/Failed).
6. Backend PropDevelopment получает ответ, при необходимости записывает логи во внутреннюю систему аудита, уведомляет пользователя.

### 3.2. Передача и синхронизация данных
- Все операции по синхронизации биометрии и номеров — **только через доверенные шины или API**, с контролем целостности и сквозного шифрования.
- Удаление или отзыв разрешения (например, собственник переехал/изменил права) незамедлительно прокидывается на платформу партнёра через API.
- Хранение и обновление данных пользователей — **мастер-данные** остаются в PropDevelopment.

### 3.3. Технические протоколы
- **REST API** с обязательным HTTPS (TLS 1.2+).
- Дополнительно возможна поддержка **gRPC** с шифрованием.
- Для обмена событиями и асинхронных уведомлений — **Webhooks** с подписанным payload.